<!-- templates/usuarios/settings_panel.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}Configuración y Personalización - SENA{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .settings-sidebar {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        height: fit-content;
        position: sticky;
        top: 2rem;
    }
    
    .settings-nav {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .settings-nav-item {
        margin-bottom: 0.5rem;
    }
    
    .settings-nav-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        color: #6c757d;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-weight: 500;
    }
    
    .settings-nav-link:hover {
        background: #f8f9fa;
        color: #007bff;
        text-decoration: none;
    }
    
    .settings-nav-link.active {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
    }
    
    .settings-nav-icon {
        width: 20px;
        text-align: center;
        font-size: 1.1rem;
    }
    
    .settings-content {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        min-height: 600px;
    }
    
    .settings-section {
        display: none;
    }
    
    .settings-section.active {
        display: block;
        animation: fadeInUp 0.3s ease;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .settings-header {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e9ecef;
    }
    
    .settings-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #212529;
        margin-bottom: 0.5rem;
    }
    
    .settings-subtitle {
        color: #6c757d;
        margin: 0;
    }
    
    .setting-group {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid #e9ecef;
    }
    
    .setting-group-title {
        font-weight: 600;
        color: #495057;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .setting-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    
    .setting-info {
        flex: 1;
    }
    
    .setting-label {
        font-weight: 500;
        color: #212529;
        margin-bottom: 0.25rem;
    }
    
    .setting-description {
        font-size: 0.85rem;
        color: #6c757d;
        margin: 0;
    }
    
    .setting-control {
        margin-left: 1rem;
    }
    
    /* Toggle Switch */
    .toggle-switch {
        position: relative;
        width: 50px;
        height: 24px;
        background: #ccc;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    
    .toggle-switch.active {
        background: #007bff;
    }
    
    .toggle-switch::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: transform 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .toggle-switch.active::after {
        transform: translateX(26px);
    }
    
    /* Theme Selector */
    .theme-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .theme-option {
        text-align: center;
        padding: 1rem;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
    }
    
    .theme-option:hover {
        border-color: #007bff;
        transform: translateY(-2px);
    }
    
    .theme-option.active {
        border-color: #007bff;
        background: rgba(0,123,255,0.05);
    }
    
    .theme-preview {
        width: 60px;
        height: 40px;
        border-radius: 8px;
        margin: 0 auto 0.5rem;
        position: relative;
        overflow: hidden;
    }
    
    .theme-light .theme-preview {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
    
    .theme-dark .theme-preview {
        background: linear-gradient(135deg, #343a40 0%, #212529 100%);
    }
    
    .theme-blue .theme-preview {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    }
    
    .theme-green .theme-preview {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
    }
    
    .theme-preview::after {
        content: '';
        position: absolute;
        top: 4px;
        left: 4px;
        right: 4px;
        height: 8px;
        background: rgba(255,255,255,0.3);
        border-radius: 4px;
    }
    
    .theme-name {
        font-size: 0.85rem;
        font-weight: 500;
        color: #495057;
    }
    
    /* Color Picker */
    .color-picker {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
    }
    
    .color-option {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.2s ease;
        position: relative;
    }
    
    .color-option:hover {
        transform: scale(1.1);
    }
    
    .color-option.active {
        border-color: #212529;
        transform: scale(1.1);
    }
    
    .color-option.active::after {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        text-shadow: 0 0 3px rgba(0,0,0,0.5);
    }
    
    /* Profile Settings */
    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        margin: 0 auto 1rem;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .profile-avatar:hover {
        transform: scale(1.05);
    }
    
    .profile-avatar-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        color: white;
        font-size: 1.2rem;
    }
    
    .profile-avatar:hover .profile-avatar-overlay {
        opacity: 1;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.5rem;
    }
    
    .form-control {
        border-radius: 8px;
        border: 2px solid #e9ecef;
        padding: 0.75rem 1rem;
        transition: all 0.2s ease;
    }
    
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    }
    
    /* Notification Settings */
    .notification-preview {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 12px;
        padding: 1rem;
        margin: 1rem 0;
        border-left: 4px solid #007bff;
    }
    
    .notification-preview-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .notification-preview-icon {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #007bff;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
    }
    
    .notification-preview-title {
        font-weight: 600;
        color: #212529;
    }
    
    .notification-preview-message {
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    /* Data Export */
    .export-option {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .export-option:hover {
        border-color: #007bff;
        transform: translateY(-2px);
    }
    
    .export-option.selected {
        border-color: #007bff;
        background: rgba(0,123,255,0.05);
    }
    
    .export-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 0.5rem;
    }
    
    .export-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #17a2b8, #138496);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }
    
    .export-title {
        font-weight: 600;
        color: #212529;
    }
    
    .export-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 0;
    }
    
    /* Save Indicator */
    .save-indicator {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: #28a745;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        transform: translateY(100px);
        transition: transform 0.3s ease;
        z-index: 1000;
    }
    
    .save-indicator.show {
        transform: translateY(0);
    }
    
    .security-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: #d4edda;
        color: #155724;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
        margin-top: 0.5rem;
    }
    
    .danger-zone {
        background: #fff5f5;
        border: 2px solid #feb2b2;
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
    }
    
    .danger-zone-title {
        color: #c53030;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    @media (max-width: 768px) {
        .settings-container {
            padding: 1rem;
        }
        
        .row {
            flex-direction: column;
        }
        
        .settings-sidebar {
            position: static;
            margin-bottom: 1rem;
        }
        
        .settings-nav {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .settings-nav-item {
            margin-right: 0.5rem;
        }
        
        .settings-nav-link {
            white-space: nowrap;
        }
        
        .theme-selector {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'usuarios:perfil' %}">Perfil</a></li>
<li class="breadcrumb-item active">Configuración</li>
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-3">
            <div class="settings-sidebar">
                <h6 class="mb-3">⚙️ Configuración</h6>
                <nav class="settings-nav">
                    <div class="settings-nav-item">
                        <a href="#" class="settings-nav-link active" data-section="profile">
                            <div class="settings-nav-icon"><i class="bi bi-person"></i></div>
                            Perfil
                        </a>
                    </div>
                    <div class="settings-nav-item">
                        <a href="#" class="settings-nav-link" data-section="appearance">
                            <div class="settings-nav-icon"><i class="bi bi-palette"></i></div>
                            Apariencia
                        </a>
                    </div>
                    <div class="settings-nav-item">
                        <a href="#" class="settings-nav-link" data-section="notifications">
                            <div class="settings-nav-icon"><i class="bi bi-bell"></i></div>
                            Notificaciones
                        </a>
                    </div>
                    <div class="settings-nav-item">
                        <a href="#" class="settings-nav-link" data-section="preferences">
                            <div class="settings-nav-icon"><i class="bi bi-sliders"></i></div>
                            Preferencias
                        </a>
                    </div>
                    <div class="settings-nav-item">
                        <a href="#" class="settings-nav-link" data-section="security">
                            <div class="settings-nav-icon"><i class="bi bi-shield-check"></i></div>
                            Seguridad
                        </a>
                    </div>
                    <div class="settings-nav-item">
                        <a href="#" class="settings-nav-link" data-section="data">
                            <div class="settings-nav-icon"><i class="bi bi-download"></i></div>
                            Mis Datos
                        </a>
                    </div>
                </nav>
            </div>
        </div>
        
        <!-- Content -->
        <div class="col-lg-9">
            <div class="settings-content">
                <!-- Profile Section -->
                <div class="settings-section active" id="profile">
                    <div class="settings-header">
                        <h2 class="settings-title">👤 Información del Perfil</h2>
                        <p class="settings-subtitle">Gestiona tu información personal y profesional</p>
                    </div>
                    
                    <div class="text-center mb-4">
                        <div class="profile-avatar" onclick="changeAvatar()">
                            {{ user.first_name.0|default:'U' }}{{ user.last_name.0|default:'' }}
                            <div class="profile-avatar-overlay">
                                <i class="bi bi-camera"></i>
                            </div>
                        </div>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    </div>
                    
                    <form id="profileForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Nombre</label>
                                    <input type="text" class="form-control" value="{{ user.first_name }}" id="firstName">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Apellido</label>
                                    <input type="text" class="form-control" value="{{ user.last_name }}" id="lastName">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" value="{{ user.email }}" id="email">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Teléfono</label>
                                    <input type="tel" class="form-control" value="{{ user.telefono }}" id="telefono">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Especialidad</label>
                                    <input type="text" class="form-control" value="{{ user.especialidad }}" id="especialidad">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Centro de Formación</label>
                                    <input type="text" class="form-control" value="{{ user.centro_formacion }}" id="centroFormacion">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Biografía</label>
                            <textarea class="form-control" rows="4" placeholder="Cuéntanos un poco sobre ti..." id="biografia"></textarea>
                        </div>
                    </form>
                </div>
                
                <!-- Appearance Section -->
                <div class="settings-section" id="appearance">
                    <div class="settings-header">
                        <h2 class="settings-title">🎨 Apariencia y Tema</h2>
                        <p class="settings-subtitle">Personaliza la interfaz según tus preferencias</p>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-brush"></i>
                            Tema del Sistema
                        </h6>
                        
                        <div class="theme-selector">
                            <div class="theme-option theme-light active" data-theme="light">
                                <div class="theme-preview"></div>
                                <div class="theme-name">Claro</div>
                            </div>
                            <div class="theme-option theme-dark" data-theme="dark">
                                <div class="theme-preview"></div>
                                <div class="theme-name">Oscuro</div>
                            </div>
                            <div class="theme-option theme-blue" data-theme="blue">
                                <div class="theme-preview"></div>
                                <div class="theme-name">Azul</div>
                            </div>
                            <div class="theme-option theme-green" data-theme="green">
                                <div class="theme-preview"></div>
                                <div class="theme-name">Verde</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-palette2"></i>
                            Color Principal
                        </h6>
                        
                        <div class="color-picker">
                            <div class="color-option active" style="background: #007bff;" data-color="#007bff"></div>
                            <div class="color-option" style="background: #28a745;" data-color="#28a745"></div>
                            <div class="color-option" style="background: #dc3545;" data-color="#dc3545"></div>
                            <div class="color-option" style="background: #ffc107;" data-color="#ffc107"></div>
                            <div class="color-option" style="background: #17a2b8;" data-color="#17a2b8"></div>
                            <div class="color-option" style="background: #6f42c1;" data-color="#6f42c1"></div>
                            <div class="color-option" style="background: #fd7e14;" data-color="#fd7e14"></div>
                            <div class="color-option" style="background: #e83e8c;" data-color="#e83e8c"></div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-eye"></i>
                            Opciones de Visualización
                        </h6>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Animaciones</div>
                                <p class="setting-description">Habilita animaciones y transiciones suaves</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="animations"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Modo Compacto</div>
                                <p class="setting-description">Reduce el espaciado para mostrar más información</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch" data-setting="compact"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Sidebar Fijo</div>
                                <p class="setting-description">Mantiene la barra lateral siempre visible</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="sidebar-fixed"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notifications Section -->
                <div class="settings-section" id="notifications">
                    <div class="settings-header">
                        <h2 class="settings-title">🔔 Notificaciones</h2>
                        <p class="settings-subtitle">Controla cómo y cuándo recibir notificaciones</p>
                    </div>
                    
                    <div class="notification-preview">
                        <div class="notification-preview-header">
                            <div class="notification-preview-icon">
                                <i class="bi bi-gear"></i>
                            </div>
                            <div class="notification-preview-title">Vista Previa de Notificación</div>
                        </div>
                        <div class="notification-preview-message">
                            Así se verán tus notificaciones con la configuración actual
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-laptop"></i>
                            Notificaciones del Sistema
                        </h6>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mantenimiento de Máquinas</div>
                                <p class="setting-description">Avisos sobre mantenimiento vencido o próximo</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="maintenance-notifications"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Órdenes de Trabajo</div>
                                <p class="setting-description">Actualizaciones sobre órdenes asignadas</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="work-order-notifications"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Documentos Nuevos</div>
                                <p class="setting-description">Notificación cuando se suben nuevos manuales</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch" data-setting="document-notifications"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-volume-up"></i>
                            Sonidos y Alertas
                        </h6>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Sonidos de Notificación</div>
                                <p class="setting-description">Reproduce sonidos para nuevas notificaciones</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="notification-sounds"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Vibración (Móvil)</div>
                                <p class="setting-description">Vibración en dispositivos móviles</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="vibration"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Preferences Section -->
                <div class="settings-section" id="preferences">
                    <div class="settings-header">
                        <h2 class="settings-title">⚙️ Preferencias del Sistema</h2>
                        <p class="settings-subtitle">Ajusta el comportamiento del sistema</p>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-speedometer2"></i>
                            Rendimiento
                        </h6>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-actualización</div>
                                <p class="setting-description">Actualiza automáticamente los datos cada 30 segundos</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="auto-refresh"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Guardado Automático</div>
                                <p class="setting-description">Guarda automáticamente los formularios mientras escribes</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="auto-save"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-list-ul"></i>
                            Vista por Defecto
                        </h6>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Página de Inicio</div>
                                <p class="setting-description">Página que se muestra al iniciar sesión</p>
                            </div>
                            <div class="setting-control">
                                <select class="form-control" style="width: 200px;" id="defaultPage">
                                    <option value="dashboard">Dashboard</option>
                                    <option value="machines">Lista de Máquinas</option>
                                    <option value="maintenance">Mantenimiento</option>
                                    <option value="documents">Documentos</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Elementos por Página</div>
                                <p class="setting-description">Cantidad de elementos mostrados en las listas</p>
                            </div>
                            <div class="setting-control">
                                <select class="form-control" style="width: 120px;" id="itemsPerPage">
                                    <option value="10">10</option>
                                    <option value="20" selected>20</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Security Section -->
                <div class="settings-section" id="security">
                    <div class="settings-header">
                        <h2 class="settings-title">🔒 Seguridad y Privacidad</h2>
                        <p class="settings-subtitle">Protege tu cuenta y datos personales</p>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-key"></i>
                            Contraseña y Acceso
                        </h6>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Cambiar Contraseña</div>
                                <p class="setting-description">Actualiza tu contraseña periódicamente</p>
                                <div class="security-badge">
                                    <i class="bi bi-shield-check"></i>
                                    Última actualización: Hace 30 días
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="btn btn-outline-primary" onclick="changePassword()">Cambiar</button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Sesiones Activas</div>
                                <p class="setting-description">Gestiona las sesiones abiertas en otros dispositivos</p>
                            </div>
                            <div class="setting-control">
                                <button class="btn btn-outline-info" onclick="manageSessions()">Ver Sesiones</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h6 class="setting-group-title">
                            <i class="bi bi-eye-slash"></i>
                            Privacidad
                        </h6>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Perfil Público</div>
                                <p class="setting-description">Permite que otros usuarios vean tu perfil</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch" data-setting="public-profile"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Actividad en Línea</div>
                                <p class="setting-description">Muestra cuando estás conectado</p>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" data-setting="online-status"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="danger-zone">
                        <h6 class="danger-zone-title">
                            <i class="bi bi-exclamation-triangle"></i>
                            Zona de Peligro
                        </h6>
                        <p class="mb-3">Las siguientes acciones son irreversibles. Procede con precaución.</p>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-danger" onclick="deleteAccount()">Eliminar Cuenta</button>
                            <button class="btn btn-outline-warning" onclick="resetSettings()">Restaurar Configuración</button>
                        </div>
                    </div>
                </div>
                
                <!-- Data Section -->
                <div class="settings-section" id="data">
                    <div class="settings-header">
                        <h2 class="settings-title">📊 Mis Datos</h2>
                        <p class="settings-subtitle">Exporta o gestiona tu información personal</p>
                    </div>
                    
                    <div class="export-option selected" data-export="profile">
                        <div class="export-header">
                            <div class="export-icon">
                                <i class="bi bi-person"></i>
                            </div>
                            <div class="export-title">Información del Perfil</div>
                        </div>
                        <p class="export-description">
                            Incluye datos personales, configuraciones y preferencias
                        </p>
                    </div>
                    
                    <div class="export-option" data-export="activity">
                        <div class="export-header">
                            <div class="export-icon">
                                <i class="bi bi-activity"></i>
                            </div>
                            <div class="export-title">Historial de Actividad</div>
                        </div>
                        <p class="export-description">
                            Registro de acciones realizadas en el sistema
                        </p>
                    </div>
                    
                    <div class="export-option" data-export="documents">
                        <div class="export-header">
                            <div class="export-icon">
                                <i class="bi bi-file-earmark"></i>
                            </div>
                            <div class="export-title">Documentos Subidos</div>
                        </div>
                        <p class="export-description">
                            Manuales y documentos que has subido al sistema
                        </p>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-primary" onclick="exportData()">
                            <i class="bi bi-download me-2"></i>
                            Exportar Datos Seleccionados
                        </button>
                        <button class="btn btn-outline-secondary ms-2" onclick="exportAll()">
                            <i class="bi bi-file-zip me-2"></i>
                            Exportar Todo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Save Indicator -->
<div class="save-indicator" id="saveIndicator">
    <i class="bi bi-check-circle me-2"></i>
    Configuración guardada
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeSettings();
    setupEventListeners();
    loadUserSettings();
});

function initializeSettings() {
    // Setup navigation
    const navLinks = document.querySelectorAll('.settings-nav-link');
    const sections = document.querySelectorAll('.settings-section');
    
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active nav
            navLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            // Show corresponding section
            const sectionId = this.dataset.section;
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        });
    });
}

function setupEventListeners() {
    // Toggle switches
    const toggles = document.querySelectorAll('.toggle-switch');
    toggles.forEach(toggle => {
        toggle.addEventListener('click', function() {
            this.classList.toggle('active');
            const setting = this.dataset.setting;
            const value = this.classList.contains('active');
            saveSetting(setting, value);
        });
    });
    
    // Theme selector
    const themeOptions = document.querySelectorAll('.theme-option');
    themeOptions.forEach(option => {
        option.addEventListener('click', function() {
            themeOptions.forEach(o => o.classList.remove('active'));
            this.classList.add('active');
            
            const theme = this.dataset.theme;
            applyTheme(theme);
            saveSetting('theme', theme);
        });
    });
    
    // Color picker
    const colorOptions = document.querySelectorAll('.color-option');
    colorOptions.forEach(option => {
        option.addEventListener('click', function() {
            colorOptions.forEach(o => o.classList.remove('active'));
            this.classList.add('active');
            
            const color = this.dataset.color;
            applyColor(color);
            saveSetting('primary-color', color);
        });
    });
    
    // Export options
    const exportOptions = document.querySelectorAll('.export-option');
    exportOptions.forEach(option => {
        option.addEventListener('click', function() {
            this.classList.toggle('selected');
        });
    });
    
    // Form inputs
    const formInputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
    formInputs.forEach(input => {
        input.addEventListener('input', debounce(() => {
            saveProfileData();
        }, 1000));
    });
    
    // Select changes
    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
        select.addEventListener('change', function() {
            const setting = this.id;
            const value = this.value;
            saveSetting(setting, value);
        });
    });
}

function loadUserSettings() {
    // Load settings from localStorage or server
    const settings = JSON.parse(localStorage.getItem('userSettings') || '{}');
    
    // Apply saved settings
    Object.keys(settings).forEach(key => {
        applySetting(key, settings[key]);
    });
}

function applySetting(key, value) {
    switch(key) {
        case 'theme':
            applyTheme(value);
            document.querySelector(`[data-theme="${value}"]`)?.classList.add('active');
            break;
        case 'primary-color':
            applyColor(value);
            document.querySelector(`[data-color="${value}"]`)?.classList.add('active');
            break;
        case 'animations':
        case 'compact':
        case 'sidebar-fixed':
            const toggle = document.querySelector(`[data-setting="${key}"]`);
            if (toggle) {
                if (value) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            }
            break;
        case 'defaultPage':
        case 'itemsPerPage':
            const select = document.getElementById(key);
            if (select) {
                select.value = value;
            }
            break;
    }
}

function saveSetting(key, value) {
    const settings = JSON.parse(localStorage.getItem('userSettings') || '{}');
    settings[key] = value;
    localStorage.setItem('userSettings', JSON.stringify(settings));
    
    // Show save indicator
    showSaveIndicator();
    
    // Send to server
    fetch('/api/user/settings/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value
        },
        body: JSON.stringify({ [key]: value })
    }).catch(error => {
        console.error('Error saving setting:', error);
    });
}

function saveProfileData() {
    const profileData = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        telefono: document.getElementById('telefono').value,
        especialidad: document.getElementById('especialidad').value,
        centroFormacion: document.getElementById('centroFormacion').value,
        biografia: document.getElementById('biografia').value
    };
    
    fetch('/api/user/profile/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value
        },
        body: JSON.stringify(profileData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSaveIndicator();
        }
    })
    .catch(error => {
        console.error('Error saving profile:', error);
    });
}

function applyTheme(theme) {
    document.body.className = document.body.className.replace(/theme-\w+/g, '');
    document.body.classList.add(`theme-${theme}`);
    
    // Apply theme colors
    const root = document.documentElement;
    switch(theme) {
        case 'dark':
            root.style.setProperty('--bg-color', '#212529');
            root.style.setProperty('--text-color', '#ffffff');
            root.style.setProperty('--card-bg', '#343a40');
            break;
        case 'blue':
            root.style.setProperty('--primary-color', '#007bff');
            break;
        case 'green':
            root.style.setProperty('--primary-color', '#28a745');
            break;
        default:
            root.style.setProperty('--bg-color', '#ffffff');
            root.style.setProperty('--text-color', '#212529');
            root.style.setProperty('--card-bg', '#ffffff');
    }
}

function applyColor(color) {
    const root = document.documentElement;
    root.style.setProperty('--primary-color', color);
    
    // Update all primary colored elements
    const primaryElements = document.querySelectorAll('.btn-primary, .bg-primary, .text-primary');
    primaryElements.forEach(el => {
        el.style.backgroundColor = color;
        el.style.borderColor = color;
    });
}

function showSaveIndicator() {
    const indicator = document.getElementById('saveIndicator');
    indicator.classList.add('show');
    
    setTimeout(() => {
        indicator.classList.remove('show');
    }, 2000);
}

function changeAvatar() {
    document.getElementById('avatarInput').click();
}

function changePassword() {
    // Implementation for password change modal
    alert('Funcionalidad de cambio de contraseña');
}

function manageSessions() {
    // Implementation for session management
    alert('Gestión de sesiones activas');
}

function deleteAccount() {
    if (confirm('¿Estás seguro de que quieres eliminar tu cuenta? Esta acción es irreversible.')) {
        if (confirm('Esta es tu última oportunidad. ¿Realmente quieres eliminar tu cuenta?')) {
            alert('Funcionalidad de eliminación de cuenta');
        }
    }
}

function resetSettings() {
    if (confirm('¿Restaurar todas las configuraciones a los valores por defecto?')) {
        localStorage.removeItem('userSettings');
        location.reload();
    }
}

function exportData() {
    const selectedOptions = document.querySelectorAll('.export-option.selected');
    const dataTypes = Array.from(selectedOptions).map(option => option.dataset.export);
    
    if (dataTypes.length === 0) {
        alert('Selecciona al menos un tipo de datos para exportar');
        return;
    }
    
    // Create download
    const data = {
        exportDate: new Date().toISOString(),
        dataTypes: dataTypes,
        user: {
            username: '{{ user.username }}',
            email: '{{ user.email }}',
            firstName: '{{ user.first_name }}',
            lastName: '{{ user.last_name }}'
        }
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `sena_data_export_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    
    URL.revokeObjectURL(url);
    showSaveIndicator();
}

function exportAll() {
    // Select all export options
    const exportOptions = document.querySelectorAll('.export-option');
    exportOptions.forEach(option => option.classList.add('selected'));
    
    exportData();
}

// Utility function for debouncing
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Handle avatar upload
document.getElementById('avatarInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatar = document.querySelector('.profile-avatar');
            avatar.style.backgroundImage = `url(${e.target.result})`;
            avatar.style.backgroundSize = 'cover';
            avatar.style.backgroundPosition = 'center';
            avatar.innerHTML = '';
            
            showSaveIndicator();
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}